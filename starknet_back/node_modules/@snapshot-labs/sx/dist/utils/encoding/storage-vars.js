"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.offsetStorageVar = exports.getStorageVarAddress = void 0;
const starknet_1 = require("starknet");
const bn_js_1 = __importDefault(require("bn.js"));
const MAX_STORAGE_ITEM_SIZE = new bn_js_1.default(256);
const ADDR_BOUND = new bn_js_1.default(2).pow(new bn_js_1.default(251)).sub(MAX_STORAGE_ITEM_SIZE);
/**
 * Returns the storage address of a StarkNet storage variable given its name and arguments.
 * https://github.com/starkware-libs/cairo-lang/blob/d61255f32a7011e9014e1204471103c719cfd5cb/src/starkware/starknet/public/abi.py#L60-L70
 * @param varName storage_var name
 * @param args additional arguments
 */
function getStorageVarAddress(varName, ...args) {
    let res = starknet_1.hash.starknetKeccak(varName);
    for (const arg of args) {
        const computedHash = starknet_1.hash.pedersen([res, new bn_js_1.default(arg.replace('0x', ''), 'hex')]);
        res = new bn_js_1.default(computedHash.replace('0x', ''), 'hex');
    }
    return res.mod(ADDR_BOUND).toString();
}
exports.getStorageVarAddress = getStorageVarAddress;
function offsetStorageVar(address, offset) {
    return new bn_js_1.default(address, 'be').add(new bn_js_1.default(offset)).toString();
}
exports.offsetStorageVar = offsetStorageVar;
